# Status Report - 2025-12-17

## Summary

Major file structure refactoring completed. The monorepo is now organized by container:
- `leo-saas/` - TypeScript SaaS platform
- `leo-container/` - Python container (partially consolidated)
- `infrastructure/` - AWS CDK + deployment scripts
- `docs/remote/` - Architecture documentation

## Completed Today

### Infrastructure Consolidation
- Moved `aws/` → `infrastructure/aws/`
- Moved deployment scripts → `infrastructure/scripts/`
- Moved `ECS-DEPLOYMENT-GUIDE.md` → `infrastructure/docs/`

### Remote Directory Migration
- Moved `remote/container/leo_container/` → `leo-container/leo_container/`
- Moved `remote/docs/` → `docs/remote/`
- Moved `remote/container/build.sh` → `leo-container/scripts/`
- Moved utility scripts → `leo-container/scripts/`
- Archived `remote/cli/` (superseded by leo-saas/wsi)
- Removed empty `remote/` directory

### Leo-saas Cleanup
- Confirmed standard Leo-generated app structure
- Kept app-specific files in place
- Moved deployment docs to infrastructure/

## Pending: Leo Container Source Consolidation

### Current State (Problematic)
```
leo-container/
├── src/leo/              # Leo agent code
├── leo_container/        # Container runtime (NOT in src/)
├── leo/                  # Resources (skills, config)
└── Dockerfile            # Has STALE paths!

vendor/                   # OUTSIDE leo-container
├── cc-agent/cc_agent/    # Agent framework
└── cc-tools/cc_tools/    # MCP tools
```

Dockerfile still references:
- `remote/container/requirements.txt` (moved)
- `vendor/` (still at root)
- `remote/container/leo_container` (moved)

### Target State
```
leo-container/
├── src/
│   ├── cc_agent/         # Vendored (no pip install -e)
│   ├── cc_tools/         # Vendored (no pip install -e)
│   ├── leo/              # Leo agent code
│   └── leo_container/    # Container runtime
├── leo/                  # Resources only (skills/, config/)
├── requirements.txt
├── Dockerfile            # Updated paths, PYTHONPATH=/app/src
└── scripts/
```

### Migration Plan

#### Step 1: Move packages to src/
```bash
# Move cc_agent package (just the Python code, not packaging artifacts)
git mv vendor/cc-agent/cc_agent leo-container/src/

# Move cc_tools package
git mv vendor/cc-tools/cc_tools leo-container/src/

# Move leo_container into src/
git mv leo-container/leo_container leo-container/src/
```

#### Step 2: Archive vendor remainder
```bash
# Archive packaging artifacts (pyproject.toml, uv.lock, docs, examples, etc.)
git mv vendor archive-2025-12-17/
```

#### Step 3: Update Dockerfile
- Remove `COPY vendor/` and `pip install -e` lines
- Update paths:
  - `COPY requirements.txt .` (already in leo-container/)
  - `COPY src/ ./src/`
  - `COPY leo/ ./leo/`
- Simplify to `PYTHONPATH=/app/src`

#### Step 4: Update imports in prompts/skills
- Search for any hardcoded paths in:
  - `leo-container/leo/skills/*.md`
  - `leo-container/src/leo/agents/**/prompt.md`
  - Any config files referencing old paths

#### Step 5: Test container build
```bash
cd leo-container
./scripts/build.sh
```

### Key Principle
**No package manager hacks** - all Python code is just packages under `src/`.
With `PYTHONPATH=/app/src`:
- `import cc_agent` works
- `import cc_tools` works
- `import leo` works
- `import leo_container` works

### Files to Delete from Vendored Code
When moving cc_agent and cc_tools, DO NOT copy:
- `.git/` (none found, but check)
- `.github/`
- `pyproject.toml`
- `uv.lock`
- `README.md`
- `CLAUDE.md`
- `docs/`
- `examples/`
- `BACKLOG/`
- `scripts/`
- `VERSION_MAPPING.md`
- `CODEARTIFACT_SETUP.md`
- `MCP_SERVERS.md`

Only copy the actual Python package directories:
- `vendor/cc-agent/cc_agent/` → `leo-container/src/cc_agent/`
- `vendor/cc-tools/cc_tools/` → `leo-container/src/cc_tools/`

## Decisions Made

1. **Rename leo/ to resources/**: Yes - `leo-container/leo/` → `leo-container/resources/` to avoid confusion with `src/leo/`

2. **cc_tools audit**: Go through all 19 tools, archive unused ones

3. **cc_agent audit**: Review all files for relevance

4. **Path updates**: Use short absolute container paths in prompts/skills (e.g., `/app/src/leo/`)

## Updated Target Structure

```
leo-container/
├── src/
│   ├── cc_agent/         # Vendored (audited)
│   ├── cc_tools/         # Vendored (audited, unused tools archived)
│   ├── leo/              # Leo agent code
│   └── leo_container/    # Container runtime
├── resources/            # Renamed from leo/
│   ├── skills/
│   └── config/
├── requirements.txt
├── Dockerfile
└── scripts/
```

## Tomorrow's Tasks

### 1. Audit cc_tools (19 tools)

| Tool | Purpose | Keep/Archive |
|------|---------|--------------|
| browser | Browser automation | TBD |
| build_test | Build/test validation | TBD |
| common | Shared utilities | TBD |
| context_manager | Context/session | TBD |
| cwd_reporter | CWD reporting | TBD |
| dalle | DALL-E images | TBD |
| dev_server | Dev server mgmt | TBD |
| graphiti | Knowledge graph | TBD |
| heroicons | Icon lookup | TBD |
| integration_analyzer | Integration analysis | TBD |
| mem0 | Memory | TBD |
| oxc | OXC linting | TBD |
| package_manager | Package mgmt | TBD |
| route_testing | Route testing | TBD |
| ruff | Ruff linting | TBD |
| shadcn | shadcn/ui | TBD |
| supabase_setup | Supabase setup | TBD |
| tree_sitter | Tree-sitter parsing | TBD |
| unsplash | Unsplash images | TBD |

**Method**: Grep for tool usage in prompts, skills, and agent code.

### 2. Audit cc_agent files

| File | Purpose | Keep/Archive |
|------|---------|--------------|
| `__init__.py` | Package init | TBD |
| `base.py` | Agent base class | TBD |
| `context/` | Context management | TBD |
| `conversation_logger.py` | Logging | TBD |
| `logging.py` | Logging utilities | TBD |
| `retry_handler.py` | Retry logic | TBD |
| `session_utils.py` | Session utilities | TBD |
| `utils.py` | General utilities | TBD |

### 3. Move packages to src/

```bash
# Move cc_agent package only (not packaging artifacts)
git mv vendor/cc-agent/cc_agent leo-container/src/

# Move cc_tools package only
git mv vendor/cc-tools/cc_tools leo-container/src/

# Move leo_container into src/
git mv leo-container/leo_container leo-container/src/

# Rename leo/ to resources/
git mv leo-container/leo leo-container/resources
```

### 4. Archive vendor remainder

```bash
git mv vendor archive-2025-12-17/
```

### 5. Update Dockerfile

Before:
```dockerfile
COPY vendor/ ./vendor/
RUN pip install --no-cache-dir -e ./vendor/cc-agent -e ./vendor/cc-tools
COPY src/ ./src/
COPY leo/skills/ ./leo/skills/
COPY leo/config/ ./leo/config/
COPY remote/container/leo_container ./leo_container/
ENV PYTHONPATH=/app:/app/src
```

After:
```dockerfile
COPY src/ ./src/
COPY resources/ ./resources/
ENV PYTHONPATH=/app/src
```

### 6. Update prompts and skills

Search and update paths in:
- `leo-container/resources/skills/*.md`
- `leo-container/src/leo/agents/**/prompt.md`
- Any config files

Old paths → New paths:
- `/app/leo/skills/` → `/app/resources/skills/`
- `/app/src/app_factory.../` → `/app/src/leo/`
- Any relative paths → Short absolute paths

### 7. Test container build

```bash
cd leo-container
./scripts/build.sh
```

## Git Status

Last commit: `7e961e42` - "chore: Consolidate remote/ into leo-container/ and infrastructure/"

Uncommitted: This STATUS file (intentionally not committed)
