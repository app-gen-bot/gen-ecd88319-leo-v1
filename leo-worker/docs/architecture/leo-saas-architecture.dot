digraph "Leo SaaS Architecture" {
  // --- Layout & Styling ---
  graph[
    rankdir=LR,
    compound=true,
    nodesep=0.6,
    ranksep=1.0,
    splines=polyline,
    fontname="Helvetica"
  ];
  node[
    shape=box,
    style="rounded,filled",
    fillcolor="white",
    color="#444444",
    fontsize=10,
    fontname="Helvetica"
  ];
  edge[
    color="#555555",
    arrowsize=0.8,
    fontsize=9,
    fontname="Helvetica"
  ];

  // --- Browser ---
  BROWSER [label="Browser", fillcolor="#FFE4B5"];

  // --- Leo SaaS Server ---
  subgraph cluster_saas {
    label=<<b>Leo SaaS Server</b><br/><font point-size="8">(Express - modules from Leo Remote)</font>>;
    labelloc="t";
    style="rounded,filled";
    color="#7A9CC6";
    bgcolor="#F7FAFF";

    UI_SERVER [label="UI Server\n(React SPA)"];
    REST_API [label="REST API"];
    WSI_SERVER [label="WSI Server\n(from Leo Remote)", fillcolor="#E8FFE8"];
    CONTAINER_MGR [label="Container Manager\n(from Leo Remote)", fillcolor="#E8FFE8"];
    DB_CLIENT [label="Database Client"];
  }

  // --- Leo Container (simplified - see leo-container-internal.dot for details) ---
  LEO_CONTAINER [
    label=<<b>Leo Container</b><br/><font point-size="8">(see internal diagram)</font>>,
    style="rounded,filled",
    fillcolor="#E0FFE0",
    color="#90C090",
    penwidth=2
  ];

  // --- External Services ---
  SUPABASE [label="Supabase\n(Auth + DB)", shape=cylinder, fillcolor="#E8E8FF"];
  GITHUB [label="GitHub", shape=cylinder, fillcolor="#FFE8E8"];
  DOCKER [label="Docker/Fargate", shape=component, fillcolor="#F0F0F0"];
  AWS_SECRETS [label="AWS Secrets\nManager", shape=cylinder, fillcolor="#E8E8FF"];

  // --- User Flow ---
  BROWSER -> UI_SERVER [label="HTTPS", dir=both];
  UI_SERVER -> REST_API;
  REST_API -> SUPABASE [label="auth/data", dir=both];
  REST_API -> WSI_SERVER;
  REST_API -> CONTAINER_MGR;
  DB_CLIENT -> SUPABASE;

  // --- Container Lifecycle ---
  CONTAINER_MGR -> DOCKER [label="spawn/stop"];
  DOCKER -> LEO_CONTAINER [style=dashed, label="container\nconnects"];

  // --- WSI Protocol ---
  LEO_CONTAINER -> WSI_SERVER [label="WSI Protocol v2.1", dir=both, penwidth=1.5, color="#009900"];

  // --- External Connections (from container) ---
  LEO_CONTAINER -> GITHUB [label="push"];
  LEO_CONTAINER -> AWS_SECRETS [label="load tokens", style=dashed];
}
