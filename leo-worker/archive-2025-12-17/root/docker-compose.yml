version: '3.8'

services:
  # Qdrant Vector Database for mem0
  qdrant:
    image: qdrant/qdrant:latest
    container_name: app-factory-qdrant
    restart: unless-stopped
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage
    environment:
      - QDRANT__LOG_LEVEL=INFO
      - QDRANT__SERVICE__GRPC_PORT=6334
    networks:
      - app-factory-network

  # Neo4j Graph Database for mem0 and tree_sitter
  neo4j:
    image: neo4j:5-community
    container_name: app-factory-neo4j
    restart: unless-stopped
    ports:
      - "7474:7474"  # HTTP interface
      - "7687:7687"  # Bolt protocol
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
    environment:
      - NEO4J_AUTH=neo4j/cc-core-password
      - NEO4J_dbms_memory_pagecache_size=512M
      - NEO4J_dbms_memory_heap_initial__size=512M
      - NEO4J_dbms_memory_heap_max__size=1G
    networks:
      - app-factory-network

  # FalkorDB Graph Database for graphiti
  falkordb:
    image: falkordb/falkordb:edge
    container_name: app-factory-falkordb
    restart: unless-stopped
    ports:
      - "6379:6379"  # Redis protocol
      - "3000:3000"  # FalkorDB UI (optional)
    volumes:
      - falkordb_data:/data
    environment:
      - FALKORDB_ARGS=--requirepass ""  # No password for local development
    networks:
      - app-factory-network

volumes:
  qdrant_data:
    name: app-factory-qdrant-data
  neo4j_data:
    name: app-factory-neo4j-data
  neo4j_logs:
    name: app-factory-neo4j-logs
  falkordb_data:
    name: app-factory-falkordb-data

networks:
  app-factory-network:
    name: app-factory-network
    driver: bridge